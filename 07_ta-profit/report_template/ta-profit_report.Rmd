---
title: "Trade-off Analysis Profit Report"
output: 
  html_document:
    toc: true
    toc_float: true
    number_sections: true
    df_print: kable
params:
  session_log: NA
  map_carbon1: NA
  map_carbon2: NA
  emission_map: NA
  opcost_map: NA
  opcost_table: NA
  opcost_curve: NA
  npv1_map: NA
  npv2_map: NA
  delta_npv: NA
  map1_file_path: NULL
  map2_file_path: NULL
  npv_file_path: NULL
  carbon_file_path: NULL
  year1: NULL
  year2: NULL
  raster_nodata: NULL
  output_dir: NULL
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(knitr)
library(kableExtra)
library(tidyr)
library(pkgdown)
library(ggplot2)
```

<details><summary>Click here for Analysis Log</summary>

```{r analysis-log, echo=FALSE}

analysis_log <- tribble(
  ~Category,                   ~Details,
  # "Analysis Start",        params$start_time,
  # "Analysis End",          params$end_time,
  "Input Data and Parameters", "",
  "Land Cover (t1)",      params$map1_file_path,
  "Land Cover (t2)",   params$map2_file_path,
  "Profitability data",   params$npv_file_path,
  "Carbon stock data",   params$carbon_file_path,
  "Year 1", as.character(params$year1),
  "Year 2", as.character(params$year2),
  "NoData land-cover class", as.character(params$raster_nodata),
  "Output Files", "",
  "Output Workspace",      paste0(getwd(), " | ", params$output_dir),
  "Session Summary", "",
) %>% rbind(format_session_info_table())

analysis_log %>% kbl(caption = "Analysis Log", escape = FALSE) %>%
  kable_paper("hover", full_width = F )
```
</details>

# Introduction

This report presents the results of a Trade-Off Analysis (Profit) based on land-use change scenarios. The analysis focuses on assessing the net present value (NPV), opportunity costs, and carbon emissions associated with different land-use changes. This method helps evaluate the financial and environmental impacts of shifting land use and identify trade-offs between profitability and sustainability.


# Analysis Results

The analysis workflow involves several key steps:

1. **NPV and Carbon Data Processing**: NPV and carbon data were combined to create a comprehensive lookup table.
2. **Land-Use Change Analysis**: The land-use change maps were processed to assess changes in NPV and carbon emissions.
3. **Opportunity Cost Calculation**: The opportunity cost table was built by evaluating the difference between carbon emissions and financial gains across different land uses.
4. **Visualization**: Maps were generated to visually represent the spatial distribution of NPV changes, carbon emissions, and opportunity costs. Additionally, an opportunity cost curve was plotted to illustrate the trade-off between financial gains and carbon emissions.

### Opportunity Cost Table
The Opportunity Cost Table presents a detailed breakdown of the trade-offs between financial gains (measured in net present value, or NPV) and environmental impacts (measured in carbon emissions) for different land-use categories over a given time period. This table is a key component in evaluating the financial viability of land-use decisions while accounting for the environmental costs.
```{r, echo=FALSE, warning=FALSE, message=FALSE}
knitr::kable(params$opcost_table)
```

### Opportunity Cost Curve
The curve visualizes the relationship between potential financial profits and the associated carbon emissions, allowing stakeholders to better understand the trade-offs involved in different land-use strategies.
```{r, echo=FALSE, warning=FALSE, message=FALSE}
plot(params$opcost_curve)
```

## Net Present Value Maps
The NPV Maps are critical visual outputs that illustrate the financial performance of different land-use categories at two distinct points in time. These maps help in understanding how land-use changes over time impact profitability, providing valuable insights for decision-makers seeking to balance economic and environmental factors.

### NPV Map 1
This map serves as a baseline for understanding the initial profitability of different land uses before any land-use changes occur. The map visually displays areas with varying degrees of profitability, using color gradients to indicate the range of NPV values.
```{r, echo=FALSE, warning=FALSE, message=FALSE}
plot(params$npv1_map)
```

### NPV Map 2
This map captures how the financial value of different land uses has evolved over the analysis period due to land-use changes, policy interventions, or natural factors. Like NPV Map 1, it uses color gradients to indicate the profitability of various land areas.
```{r, echo=FALSE, warning=FALSE, message=FALSE}
plot(params$npv2_map)
```

### Delta NPV Map
This map highlights the regions where significant changes in NPV occurred due to land-use changes. Areas with high profitability shifts are marked in green, while those with reduced profitability are marked in red.
```{r, echo=FALSE, warning=FALSE, message=FALSE}
# plot(params$delta_npv)
color_palette <- c("darkred", "white", "darkgreen")
plot(params$delta_npv, 
       col = color_palette,   
       colNA = "grey",        
       main = "NPV Change",
       legend.args = list(text = NULL, side = 4, font = 2, line = 2.5, cex = 1.2))
```

# Conclusion
The report highlights the key trade-offs between financial returns and environmental sustainability. It provides essential insights for decision-makers to balance profitability with environmental responsibility in land-use planning. The generated maps and opportunity cost curves serve as valuable tools for evaluating these trade-offs across various scenarios.
